<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>CTRLPLAY INTERNAL PORTAL</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<style>
        /* Performance Optimized Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a0f2e 50%, #2d1b69 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Optimized animated background */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }

        /* Login Screen - enhanced with animations */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            opacity: 1;
            transition: opacity 0.8s ease;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            transform: translateY(0);
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.6s;
            z-index: 10;
        }

        .login-box:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(79, 172, 254, 0.3);
        }

        .logo {
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #4facfe, #00f2fe, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(79, 172, 254, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        @keyframes glow {
            from { filter: brightness(1); }
            to { filter: brightness(1.4); }
        }

        .subtitle {
            color: #b0b0b0;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .input-group {
            margin-bottom: 25px;
            position: relative;
        }

        input {
            width: 100%;
            padding: 15px;
            border: 1px solid rgba(79, 172, 254, 0.4);
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 16px;
            text-align: center;
            letter-spacing: 2px;
            transition: all 0.3s ease;
            outline: none;
        }

        input:focus {
            border-color: #4facfe;
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.5);
        }

        input::placeholder {
            color: #888;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.6);
            background: linear-gradient(45deg, #764ba2, #667eea);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .error {
            color: #ff6b6b;
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            background: rgba(255, 107, 107, 0.15);
            border: 1px solid rgba(255, 107, 107, 0.3);
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        /* Main App Layout - enhanced with animations */
        .app-container {
            display: none;
            min-height: 100vh;
            opacity: 0;
            animation: fadeIn 0.8s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(15px);
            border-right: 1px solid rgba(79, 172, 254, 0.2);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.5);
        }

        .sidebar-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-brand {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(45deg, #4facfe, #00f2fe, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(79, 172, 254, 0.3);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .user-info {
            font-size: 0.95rem;
            color: #b0b0b0;
            margin-top: 8px;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 16px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            margin: 5px 0;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(79, 172, 254, 0.1), transparent);
            transition: left 0.5s;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-left-color: #4facfe;
        }

        .nav-item:hover::before {
            left: 100%;
        }

        .nav-item.active {
            background: rgba(79, 172, 254, 0.15);
            border-left-color: #4facfe;
        }

        .nav-icon {
            margin-right: 15px;
            font-size: 1.3rem;
            width: 24px;
            text-align: center;
        }

        .logout-btn {
            position: absolute;
            bottom: 25px;
            left: 20px;
            right: 20px;
            background: rgba(255, 107, 107, 0.15);
            border: 1px solid rgba(255, 107, 107, 0.4);
            color: #ff6b6b;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: rgba(255, 107, 107, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            padding: 30px;
            transition: margin-left 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .content-section {
            display: none;
            animation: slideInFromRight 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes slideInFromRight {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 35px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 2.2rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
        }

        .section-subtitle {
            color: #b0b0b0;
            font-size: 1.1rem;
        }

        /* Cards - premium enhanced */
        .card {
            background: rgba(255, 255, 255, 0.07);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: left 0.7s;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(79, 172, 254, 0.3);
            border-color: rgba(79, 172, 254, 0.4);
        }

        .card:hover::before {
            left: 100%;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffffff;
        }

        .card-date {
            color: #888;
            font-size: 0.9rem;
        }

        /* Forms - enhanced */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #b0b0b0;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus {
            border-color: #4facfe;
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.3);
            outline: none;
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.6);
            background: linear-gradient(45deg, #764ba2, #667eea);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ff5722);
            border: none;
            padding: 9px 18px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        /* Edit mode styles */
        .edit-mode {
            background: rgba(255, 193, 7, 0.1);
            border-color: rgba(255, 193, 7, 0.4);
        }

        .edit-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-edit {
            background: linear-gradient(45deg, #ffc107, #ff9800);
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 10px;
        }

        .btn-save {
            background: linear-gradient(45deg, #28a745, #20c997);
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 10px;
        }

        .btn-cancel {
            background: linear-gradient(45deg, #6c757d, #495057);
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 10px;
        }

        /* Admin Dashboard enhancements */
        .admin-section {
            background: rgba(255, 215, 0, 0.08);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .log-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            border-radius: 10px;
            margin-bottom: 8px;
            background: rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }

        .log-entry:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(5px);
        }

        .log-details {
            display: none;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-top: 10px;
            border-left: 3px solid #4facfe;
        }

        .log-details p {
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .status-admin {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }

        .status-employee {
            background: rgba(79, 172, 254, 0.2);
            color: #4facfe;
        }

        .device-info {
            font-size: 0.85rem;
            color: #888;
            margin-top: 5px;
        }

        /* Mobile Responsive - enhanced */
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 25px;
            left: 25px;
            z-index: 1001;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(79, 172, 254, 0.4);
            color: white;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .mobile-toggle:hover {
            background: rgba(79, 172, 254, 0.2);
            transform: rotate(90deg);
        }

        @media (max-width: 768px) {
            .mobile-toggle {
                display: block;
            }

            .sidebar {
                transform: translateX(-100%);
                width: 80%;
            }

            .sidebar.open {
                transform: translateX(0);
                box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            }

            .main-content {
                margin-left: 0;
                padding-top: 80px;
            }
        }

        /* Enhanced animations */
        @keyframes floatUp {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .float-up {
            animation: floatUp 0.6s ease forwards;
        }

        /* Loading animations - enhanced */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(20px);
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        .loading-spinner {
            width: 70px;
            height: 70px;
            border: 5px solid rgba(79, 172, 254, 0.3);
            border-top: 5px solid #4facfe;
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
        }

        .loading-text {
            margin-top: 25px;
            color: #4facfe;
            font-size: 1.3rem;
            font-weight: 500;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Notification system */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 18px 25px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 9999;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            transform: translateX(150%);
            opacity: 0;
            animation: slideIn 0.5s forwards, fadeOut 0.5s forwards 2.5s;
        }

        @keyframes slideIn {
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            to { opacity: 0; }
        }

        .notification.success {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid rgba(40, 167, 69, 0.4);
        }

        .notification.error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid rgba(220, 53, 69, 0.4);
        }

        .notification.info {
            background: rgba(23, 162, 184, 0.2);
            border: 1px solid rgba(23, 162, 184, 0.4);
        }

        /* Edit buttons */
        .edit-btn {
            background: rgba(255, 193, 7, 0.15);
            border: 1px solid rgba(255, 193, 7, 0.3);
            color: #ffc107;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .edit-btn:hover {
            background: rgba(255, 193, 7, 0.25);
        }

        /* Enhanced Chat System Styles - Discord-like */
        .chat-container {
            display: flex;
            height: 70vh;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.3);
        }

        .chat-sidebar {
            width: 250px;
            background: rgba(0, 0, 0, 0.3);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            position: relative;
            transition: width 0.3s ease;
        }

        .chat-sidebar-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(79, 172, 254, 0.3);
            border: none;
            color: white;
            padding: 5px 8px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10;
        }

        .chat-sidebar.collapsed {
            width: 0;
            overflow: hidden;
        }

        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-input-area {
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }

        .chat-user {
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            position: relative;
        }

        .chat-user:hover {
            background: rgba(79, 172, 254, 0.1);
        }

        .chat-user.active {
            background: rgba(79, 172, 254, 0.2);
        }

        .chat-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            background: #4facfe;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            background: rgba(79, 172, 254, 0.1);
            max-width: 70%;
            animation: floatUp 0.3s ease;
            position: relative;
        }

        .chat-message.sent {
            margin-left: auto;
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .chat-message.received {
            margin-right: auto;
        }

        .message-time {
            font-size: 0.75rem;
            color: #b0b0b0;
            margin-top: 5px;
            text-align: right;
        }

        .message-sender {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }

        .message-sender-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .message-actions {
            position: absolute;
            top: 5px;
            right: 10px;
            display: none;
        }

        .chat-message:hover .message-actions {
            display: flex;
            gap: 5px;
        }

        .message-action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #b0b0b0;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.7rem;
        }

        .message-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* Avatar upload styles */
        .avatar-upload {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-right: 20px;
            object-fit: cover;
            border: 2px solid #4facfe;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.2);
        }

        .avatar-upload-controls {
            flex: 1;
        }

        /* File attachment styles */
        .file-attachment {
            display: flex;
            align-items: center;
            margin-top: 10px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .file-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .file-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-download {
            color: #4facfe;
            cursor: pointer;
        }

        /* Custom file input */
        .custom-file-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .file-input-label {
            background: rgba(79, 172, 254, 0.2);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-input-label:hover {
            background: rgba(79, 172, 254, 0.3);
        }

        /* Comment system */
        .comment-section {
            margin-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 15px;
        }

        .comment {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            position: relative;
        }

        .comment-author {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }

        .comment-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .comment-date {
            font-size: 0.8rem;
            color: #888;
        }

        /* Profile settings */
        .profile-settings {
            max-width: 500px;
        }

        /* File upload preview */
        .file-upload-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .file-preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.3);
        }

        .file-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .file-preview-item .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(220, 53, 69, 0.8);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        /* Sound notification */
        .sound-notification {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }

        /* Admin force logout */
        .force-logout-btn {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid rgba(220, 53, 69, 0.4);
            color: #dc3545;
            padding: 4px 8px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .force-logout-btn:hover {
            background: rgba(220, 53, 69, 0.3);
        }
    </style>
</head>
<body>
<!-- Animated Background -->
<div id="particles-js"></div>
<!-- Login Screen -->
<div class="login-container" id="loginScreen">
<div class="login-box">
<div class="logo">CTRLPLAY</div>
<div class="subtitle">Internal Team Portal</div>
<div class="input-group">
<input id="accessCode" maxlength="20" placeholder="Enter Access Code" type="text"/>
</div>
<button class="btn" onclick="validateAccess()">Access Portal</button>
<div class="error" id="errorMessage" style="display: none;"></div>
</div>
</div>
<!-- Sound notification -->
<audio class="sound-notification" id="notificationSound">
<source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-marimba-283.mp3" type="audio/mpeg"/>
</audio>
<!-- Main Application -->
<div class="app-container" id="appContainer">
<!-- Mobile Toggle -->
<button class="mobile-toggle" onclick="toggleSidebar()">☰</button>
<!-- Sidebar -->
<div class="sidebar" id="sidebar">
<div class="sidebar-header">
<div class="sidebar-brand">CTRLPLAY</div>
<div class="user-info">Welcome, <span id="userName"></span> (<span id="userRole"></span>)</div>
</div>
<div class="nav-menu">
<div class="nav-item active" onclick="showSection('announcements')">
<span class="nav-icon">🛰️</span>
<span>Announcements</span>
</div>
<div class="nav-item" onclick="showSection('suggestions')">
<span class="nav-icon">💡</span>
<span>Suggestions &amp; Ideas</span>
</div>
<div class="nav-item" onclick="showSection('stock-guide')">
<span class="nav-icon">📦</span>
<span>How to Get Stock?</span>
</div>
<div class="nav-item" onclick="showSection('files')">
<span class="nav-icon">📁</span>
<span>Files</span>
</div>
<div class="nav-item" onclick="showSection('chat')">
<span class="nav-icon">💬</span>
<span>Team Chat</span>
</div>
<div class="nav-item" onclick="showSection('profile')">
<span class="nav-icon">👤</span>
<span>My Profile</span>
</div>
<div class="nav-item admin-only" onclick="showSection('admin')" style="display: none;">
<span class="nav-icon">🛡️</span>
<span>Admin Dashboard</span>
</div>
</div>
<button class="logout-btn" onclick="logout()">
<i class="fas fa-sign-out-alt"></i> Logout
            </button>
</div>
<!-- Main Content -->
<div class="main-content">
<!-- Announcements Section -->
<div class="content-section active" id="announcements">
<div class="section-header">
<h1 class="section-title">Announcements</h1>
<p class="section-subtitle">Stay updated with the latest news and updates</p>
</div>
<div class="admin-only" style="display: none;">
<div class="card">
<h3>Post New Announcement</h3>
<div class="form-group">
<label class="form-label">Title</label>
<input class="form-input" id="announcementTitle" placeholder="Announcement title" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Content</label>
<textarea class="form-textarea" id="announcementContent" placeholder="Announcement content"></textarea>
</div>
<div class="form-group">
<label class="form-label">Attachment</label>
<div class="custom-file-input">
<label class="file-input-label" for="announcementAttachment">
<i class="fas fa-paperclip"></i> Choose File
                                </label>
<span id="announcementFileName">No file chosen</span>
<input class="sound-notification" id="announcementAttachment" style="display: none;" type="file"/>
</div>
<div class="file-upload-preview" id="announcementAttachmentPreview"></div>
</div>
<button class="btn-primary" onclick="postAnnouncement()">Post Announcement</button>
</div>
</div>
<div id="announcementsList"></div>
</div>
<!-- Suggestions & Ideas Section -->
<div class="content-section" id="suggestions">
<div class="section-header">
<h1 class="section-title">Suggestions &amp; Ideas</h1>
<p class="section-subtitle">Share your ideas and help improve CTRLPLAY</p>
</div>
<div class="card">
<h3>Submit New Suggestion</h3>
<div class="form-group">
<label class="form-label">Title</label>
<input class="form-input" id="suggestionTitle" placeholder="Suggestion title" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Description</label>
<textarea class="form-textarea" id="suggestionContent" placeholder="Describe your suggestion or issue"></textarea>
</div>
<div class="form-group">
<label class="form-label">Type</label>
<select class="form-input" id="suggestionType">
<option value="suggestion">Suggestion</option>
<option value="idea">Idea</option>
<option value="issue">Issue</option>
</select>
</div>
<div class="form-group">
<label class="form-label">Attachment</label>
<div class="custom-file-input">
<label class="file-input-label" for="suggestionAttachment">
<i class="fas fa-paperclip"></i> Choose File
                            </label>
<span id="suggestionFileName">No file chosen</span>
<input class="sound-notification" id="suggestionAttachment" style="display: none;" type="file"/>
</div>
<div class="file-upload-preview" id="suggestionAttachmentPreview"></div>
</div>
<button class="btn-primary" onclick="submitSuggestion()">Submit</button>
</div>
<div id="suggestionsList"></div>
</div>
<!-- Stock Guide Section -->
<div class="content-section" id="stock-guide">
<div class="section-header">
<h1 class="section-title">How to Get Stock?</h1>
<p class="section-subtitle">Learn how CTRLPLAY acquires and manages products</p>
</div>
<div class="admin-only" style="display: none;">
<div class="card">
<h3>Update Stock Guide</h3>
<div class="form-group">
<textarea class="form-textarea" id="stockGuideContent" placeholder="Update the stock guide content" style="min-height: 250px;"></textarea>
</div>
<button class="btn-primary" onclick="updateStockGuide()">Update Guide</button>
</div>
</div>
<div class="card" id="stockGuideDisplay">
<div id="stockGuideText">
<h3>Product Sourcing Guide</h3>
<p>Welcome to the CTRLPLAY product sourcing guide. Here's how we acquire and manage our inventory:</p>
<h4>1. Supplier Research</h4>
<p>We research reliable suppliers who offer quality products at competitive prices.</p>
<h4>2. Quality Assessment</h4>
<p>All products undergo thorough quality checks before being added to our inventory.</p>
<h4>3. Inventory Management</h4>
<p>We use advanced inventory tracking systems to monitor stock levels and ensure availability.</p>
<h4>4. Customer Feedback Integration</h4>
<p>Customer reviews and feedback are continuously monitored to improve our product selection.</p>
</div>
</div>
</div>
<!-- Files Section -->
<div class="content-section" id="files">
<div class="section-header">
<h1 class="section-title">Files</h1>
<p class="section-subtitle">Access shared documents and resources</p>
</div>
<div class="admin-only" style="display: none;">
<div class="card">
<h3>Upload New File</h3>
<div class="form-group">
<label class="form-label">File Name</label>
<input class="form-input" id="fileName" placeholder="Enter file name" type="text"/>
</div>
<div class="form-group">
<label class="form-label">File Type</label>
<select class="form-input" id="fileType">
<option value="document">Document</option>
<option value="image">Image</option>
<option value="spreadsheet">Spreadsheet</option>
<option value="presentation">Presentation</option>
<option value="other">Other</option>
</select>
</div>
<div class="form-group">
<label class="form-label">File</label>
<div class="custom-file-input">
<label class="file-input-label" for="fileUpload">
<i class="fas fa-cloud-upload-alt"></i> Choose File
                                </label>
<span id="uploadFileName">No file chosen</span>
<input class="sound-notification" id="fileUpload" style="display: none;" type="file"/>
</div>
</div>
<button class="btn-primary" onclick="uploadFile()">Upload File</button>
</div>
</div>
<div id="filesList"></div>
</div>
<!-- Chat Section -->
<div class="content-section" id="chat">
<div class="section-header">
<h1 class="section-title">Team Chat</h1>
<p class="section-subtitle">Communicate with your team in real-time</p>
</div>
<div class="card">
<div class="chat-container">
<div class="chat-sidebar" id="chatSidebar">
<button class="chat-sidebar-toggle" onclick="toggleChatSidebar()">
<i class="fas fa-times"></i>
</button>
<div id="chatUsersList">
<!-- Users will be populated here -->
</div>
</div>
<div class="chat-main">
<div class="chat-header" id="chatHeader">
<div>Select a user to start chatting</div>
<button class="btn" onclick="toggleChatSidebar()">
<i class="fas fa-users"></i> Show Users
                                </button>
</div>
<div class="chat-messages" id="chatMessages">
<!-- Messages will appear here -->
</div>
<div class="chat-input-area" id="chatInputArea" style="display: none;">
<div class="custom-file-input" style="margin-bottom: 10px;">
<label class="file-input-label" for="chatAttachment">
<i class="fas fa-paperclip"></i> Attach File
                                    </label>
<input class="sound-notification" id="chatAttachment" style="display: none;" type="file"/>
</div>
<div class="form-group" style="display: flex; gap: 10px;">
<textarea class="form-input" id="chatMessageInput" placeholder="Type your message..." rows="2" style="flex: 1;"></textarea>
<button class="btn-primary" onclick="sendChatMessage()">Send</button>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Profile Section -->
<div class="content-section" id="profile">
<div class="section-header">
<h1 class="section-title">My Profile</h1>
<p class="section-subtitle">Manage your account settings</p>
</div>
<div class="card">
<div class="avatar-upload">
<div class="avatar-preview" id="avatarPreview"></div>
<div class="avatar-upload-controls">
<label class="form-label">Change Avatar</label>
<div class="custom-file-input">
<label class="file-input-label" for="avatarUpload">
<i class="fas fa-cloud-upload-alt"></i> Upload Image
                                </label>
<input accept="image/*" id="avatarUpload" style="display: none;" type="file"/>
</div>
</div>
</div>
<div class="form-group">
<label class="form-label">Display Name</label>
<input class="form-input" id="displayName" placeholder="Enter your display name" type="text"/>
</div>
<button class="btn-primary" onclick="updateProfile()">Save Changes</button>
</div>
</div>
<!-- Admin Dashboard -->
<div class="content-section admin-only" id="admin" style="display: none;">
<div class="section-header">
<h1 class="section-title">Admin Dashboard</h1>
<p class="section-subtitle">Manage portal settings and monitor activity</p>
</div>
<div class="card admin-section">
<h3>Active Users</h3>
<div id="activeUsersList"></div>
</div>
<div class="card admin-section">
<h3>Access Logs</h3>
<div class="form-group">
<button class="btn-primary" onclick="refreshAccessLogs()">Refresh Logs</button>
<button class="btn-danger" onclick="clearAccessLogs()" style="margin-left: 10px;">Clear Logs</button>
</div>
<div id="accessLogs"></div>
</div>
<div class="card admin-section">
<h3>Manage Access Codes</h3>
<div class="form-group">
<label class="form-label">New Access Code</label>
<input class="form-input" id="newAccessCode" placeholder="CP-TEAM-XXXX-XXXX" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Role</label>
<select class="form-input" id="newCodeRole">
<option value="Employee">Employee</option>
<option value="Admin">Admin</option>
</select>
</div>
<button class="btn-primary" onclick="addAccessCode()">Add Code</button>
<h4 style="margin-top: 30px;">Current Access Codes</h4>
<div class="code-list" id="codesList"></div>
</div>
</div>
</div>
</div>
<!-- Particles.js library -->
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
        // Enhanced access codes database
        const accessCodes = {
            'CP-TEAM-K9QX-V3ZT': { role: 'Employee', name: 'Employee 1', avatar: '', customName: '' },
            'CP-TEAM-F2LJ-8NWD': { role: 'Employee', name: 'Employee 2', avatar: '', customName: '' },
            'CP-TEAM-Z7UM-P4TK': { role: 'Employee', name: 'Employee 3', avatar: '', customName: '' },
            'CP-TEAM-W3CY-MX9L': { role: 'Employee', name: 'Employee 4', avatar: '', customName: '' },
            'CP-TEAM-DRQ1-7EVA': { role: 'Employee', name: 'Employee 5', avatar: '', customName: '' },
            'CP-TEAM-TN2H-KC8Y': { role: 'Employee', name: 'Employee 6', avatar: '', customName: '' },
            'CP-TEAM-YL3B-QX5W': { role: 'Employee', name: 'Employee 7', avatar: '', customName: '' },
            'CP-TEAM-MV8J-HQ2Z': { role: 'Employee', name: 'Employee 8', avatar: '', customName: '' },
            'CP-TEAM-GBQX-N71C': { role: 'Employee', name: 'Employee 9', avatar: '', customName: '' },
            'CP-TEAM-VTZK-J4MW': { role: 'Employee', name: 'Employee 10', avatar: '', customName: '' },
            'CP-ADMIN-Z84L-X9KT': { role: 'Admin', name: 'Admin 1', avatar: '', customName: '' },
            'CP-ADMIN-T29J-Q3WB': { role: 'Admin', name: 'Admin 2', avatar: '', customName: '' }
        };

        // Current user session
        let currentUser = {
            code: '',
            role: '',
            name: '',
            loginTime: '',
            avatar: '',
            customName: ''
        };

        // Data storage
        let announcements = [
            {
                id: 1,
                title: 'Welcome to CTRLPLAY Portal',
                content: 'Welcome to our new internal portal! Here you can access all team resources, share ideas, and stay updated with company news.',
                date: new Date().toLocaleDateString(),
                author: 'Admin',
                authorCode: 'CP-ADMIN-Z84L-X9KT',
                attachment: null
            }
        ];

        let suggestions = [];
        let files = [
            {
                id: 1,
                name: 'Brand Guidelines.pdf',
                type: 'document',
                uploadDate: new Date().toLocaleDateString(),
                uploader: 'Admin',
                uploaderCode: 'CP-ADMIN-Z84L-X9KT',
                fileData: null
            },
            {
                id: 2,
                name: 'Product Catalog.xlsx',
                type: 'spreadsheet',
                uploadDate: new Date().toLocaleDateString(),
                uploader: 'Admin',
                uploaderCode: 'CP-ADMIN-Z84L-X9KT',
                fileData: null
            }
        ];

        let accessLogs = [];
        let stockGuide = '';
        let chatMessages = {};
        let currentChatUser = null;
        let activeUsers = {};

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize particles.js with optimized configuration
            particlesJS('particles-js', {
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    color: { value: "#ffffff" },
                    shape: { type: "circle" },
                    opacity: { value: 0.5, random: true },
                    size: { value: 3, random: true },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: "#4facfe",
                        opacity: 0.4,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 2,
                        direction: "none",
                        random: true,
                        straight: false,
                        out_mode: "out",
                        bounce: false
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "grab" },
                        onclick: { enable: true, mode: "push" },
                        resize: true
                    },
                    modes: {
                        grab: { distance: 140, line_linked: { opacity: 1 } },
                        push: { particles_nb: 4 }
                    }
                },
                retina_detect: true
            });
            
            loadData();
            
            // Handle Enter key on login
            document.getElementById('accessCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    validateAccess();
                }
            });

            // Handle avatar upload preview
            document.getElementById('avatarUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.getElementById('avatarPreview').innerHTML = '';
                        document.getElementById('avatarPreview').style.backgroundImage = `url(${event.target.result})`;
                        document.getElementById('avatarPreview').style.backgroundSize = 'cover';
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Handle announcement attachment
            document.getElementById('announcementAttachment').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    document.getElementById('announcementFileName').textContent = file.name;
                }
            });

            // Handle suggestion attachment
            document.getElementById('suggestionAttachment').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    document.getElementById('suggestionFileName').textContent = file.name;
                }
            });

            // Handle file upload
            document.getElementById('fileUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    document.getElementById('uploadFileName').textContent = file.name;
                }
            });

            // Handle chat attachment
            document.getElementById('chatAttachment').addEventListener('change', function(e) {
                // Implementation for chat attachments
            });

            // Auto-logout on page refresh/close
            window.addEventListener('beforeunload', function() {
                logout();
            });
            
            // Simulate active users
            setInterval(() => {
                if (currentUser.code) {
                    activeUsers[currentUser.code] = {
                        name: currentUser.name,
                        role: currentUser.role,
                        lastActive: new Date().toISOString()
                    };
                    saveData();
                    if (currentUser.role === 'Admin') {
                        loadActiveUsers();
                    }
                }
            }, 30000);
        });

        function validateAccess() {
            const code = document.getElementById('accessCode').value.trim().toUpperCase();
            const errorDiv = document.getElementById('errorMessage');

            if (!code) {
                errorDiv.textContent = 'Please enter an access code.';
                errorDiv.style.display = 'block';
                return;
            }

            // Show loading animation
            showLoadingOverlay('Validating access...');

            // Simulate network delay for realistic experience
            setTimeout(() => {
                if (accessCodes[code]) {
                    // Valid code - log user in
                    currentUser = {
                        code: code,
                        role: accessCodes[code].role,
                        name: accessCodes[code].customName || accessCodes[code].name,
                        loginTime: new Date().toLocaleString(),
                        avatar: accessCodes[code].avatar,
                        customName: accessCodes[code].customName || ''
                    };

                    // Log the access with device info
                    accessLogs.push({
                        code: code,
                        role: accessCodes[code].role,
                        name: accessCodes[code].customName || accessCodes[code].name,
                        loginTime: currentUser.loginTime,
                        userAgent: navigator.userAgent,
                        platform: navigator.platform,
                        language: navigator.language,
                        ip: 'xxx.xxx.xxx.xxx' // Simulated IP
                    });

                    // Add to active users
                    activeUsers[code] = {
                        name: currentUser.name,
                        role: currentUser.role,
                        lastActive: new Date().toISOString()
                    };

                    updateLoadingText('Access granted! Loading portal...');
                    
                    setTimeout(() => {
                        hideLoadingOverlay();
                        
                        // Show main app
                        document.getElementById('loginScreen').style.display = 'none';
                        document.getElementById('appContainer').style.display = 'block';
                        document.getElementById('userRole').textContent = currentUser.role;
                        document.getElementById('userName').textContent = currentUser.name;

                        // Show admin features if admin
                        if (currentUser.role === 'Admin') {
                            document.querySelectorAll('.admin-only').forEach(el => {
                                el.style.display = 'block';
                            });
                        }

                        // Load initial content
                        loadAnnouncements();
                        loadSuggestions();
                        loadFiles();
                        loadAccessLogs();
                        loadStockGuide();
                        loadCodesList();
                        loadChatUsers();
                        loadProfileData();
                        loadActiveUsers();

                        errorDiv.style.display = 'none';
                        showWelcomeMessage();
                    }, 1000);

                } else {
                    // Invalid code
                    updateLoadingText('Invalid access code...');
                    setTimeout(() => {
                        hideLoadingOverlay();
                        errorDiv.textContent = 'Invalid access code. Please try again.';
                        errorDiv.style.display = 'block';
                        document.getElementById('accessCode').value = '';
                    }, 1000);
                }
            }, 1500);
        }

        // Enhanced logout with animation
        function logout() {
            showLoadingOverlay('Signing out...');
            
            setTimeout(() => {
                // Remove from active users
                if (currentUser.code) {
                    delete activeUsers[currentUser.code];
                }
                
                currentUser = { code: '', role: '', name: '', loginTime: '', avatar: '', customName: '' };
                hideLoadingOverlay();
                
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
                document.getElementById('accessCode').value = '';
                document.getElementById('errorMessage').style.display = 'none';
                
                // Hide admin features
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'none';
                });
                
                showNotification('Successfully logged out', 'info');
            }, 1000);
        }

        // Loading overlay functions
        function showLoadingOverlay(text = 'Loading...') {
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';
            overlay.id = 'loadingOverlay';
            overlay.innerHTML = `
                <div style="text-align: center;">
                    <div class="loading-spinner"></div>
                    <div class="loading-text" id="loadingText">${text}</div>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        function updateLoadingText(text) {
            const loadingText = document.getElementById('loadingText');
            if (loadingText) {
                loadingText.textContent = text;
            }
        }

        function hideLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                }, 300);
            }
        }

        // Navigation functions
        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active');
            });

            document.getElementById(section).classList.add('active');
            event.target.closest('.nav-item').classList.add('active');

            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
            }

            // Load specific content if needed
            if (section === 'chat' && currentChatUser) {
                loadChatMessages(currentChatUser);
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }
        
        function toggleChatSidebar() {
            document.getElementById('chatSidebar').classList.toggle('collapsed');
        }

        // Announcements functions with edit capability
        function loadAnnouncements() {
            const container = document.getElementById('announcementsList');
            container.innerHTML = '';

            announcements.forEach(announcement => {
                const card = document.createElement('div');
                card.className = 'card float-up';
                
                if (announcement.editing) {
                    // Edit mode
                    card.innerHTML = `
                        <div class="form-group">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-input" id="edit-title-${announcement.id}" value="${announcement.title}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Content</label>
                            <textarea class="form-textarea" id="edit-content-${announcement.id}">${announcement.content}</textarea>
                        </div>
                        ${announcement.attachment ? `
                        <div class="file-attachment">
                            <i class="fas fa-paperclip file-icon"></i>
                            <div class="file-name">${announcement.attachment.name}</div>
                            <i class="fas fa-trash file-download" onclick="removeAnnouncementAttachment(${announcement.id})"></i>
                        </div>
                        ` : ''}
                        <div class="form-group">
                            <label class="form-label">Change Attachment (Optional)</label>
                            <input type="file" class="form-input" id="edit-attachment-${announcement.id}">
                        </div>
                        <div class="edit-controls">
                            <button class="btn-save" onclick="saveAnnouncement(${announcement.id})">Save</button>
                            <button class="btn-cancel" onclick="cancelEditAnnouncement(${announcement.id})">Cancel</button>
                        </div>
                    `;
                } else {
                    // Display mode
                    card.innerHTML = `
                        <div class="card-header">
                            <div class="card-title">${announcement.title}</div>
                            <div class="card-date">${announcement.date}</div>
                        </div>
                        <p>${announcement.content}</p>
                        ${announcement.attachment ? `
                        <div class="file-attachment">
                            <i class="fas fa-paperclip file-icon"></i>
                            <div class="file-name">${announcement.attachment.name}</div>
                            <i class="fas fa-download file-download" onclick="downloadFile('${announcement.attachment.name}', '${announcement.attachment.data}')"></i>
                        </div>
                        ` : ''}
                        <div class="comment-section">
                            <div class="comment">
                                <div class="comment-author">
                                    <div class="comment-avatar" style="background-color: ${stringToColor(announcement.authorCode)}">
                                        ${announcement.author.charAt(0).toUpperCase()}
                                    </div>
                                    ${announcement.author}
                                </div>
                                <div class="comment-date">Posted on ${announcement.date}</div>
                            </div>
                        </div>
                        <div class="edit-controls">
                            ${currentUser.role === 'Admin' || currentUser.code === announcement.authorCode ? `
                                <button class="btn-edit" onclick="editAnnouncement(${announcement.id})">Edit</button>
                                <button class="btn-danger" onclick="deleteAnnouncement(${announcement.id})">Delete</button>
                            ` : ''}
                        </div>
                    `;
                }
                
                container.appendChild(card);
            });
        }

        function postAnnouncement() {
            const title = document.getElementById('announcementTitle').value.trim();
            const content = document.getElementById('announcementContent').value.trim();
            const attachmentInput = document.getElementById('announcementAttachment');
            let attachment = null;

            if (title && content) {
                if (attachmentInput.files.length > 0) {
                    const file = attachmentInput.files[0];
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        attachment = {
                            name: file.name,
                            type: file.type,
                            data: event.target.result.split(',')[1]
                        };
                        completeAnnouncementPost(title, content, attachment);
                    };
                    reader.readAsDataURL(file);
                } else {
                    completeAnnouncementPost(title, content, null);
                }
            }
        }

        function completeAnnouncementPost(title, content, attachment) {
            const newAnnouncement = {
                id: Date.now(),
                title: title,
                content: content,
                date: new Date().toLocaleDateString(),
                author: currentUser.name,
                authorCode: currentUser.code,
                attachment: attachment
            };

            announcements.unshift(newAnnouncement);
            loadAnnouncements();
            
            document.getElementById('announcementTitle').value = '';
            document.getElementById('announcementContent').value = '';
            document.getElementById('announcementAttachment').value = '';
            document.getElementById('announcementFileName').textContent = 'No file chosen';
            document.getElementById('announcementAttachmentPreview').innerHTML = '';
            
            saveData();
            showNotification('Announcement posted successfully!', 'success');
            playNotificationSound();
        }

        function editAnnouncement(id) {
            const announcement = announcements.find(a => a.id === id);
            if (announcement) {
                announcement.editing = true;
                loadAnnouncements();
            }
        }

        function saveAnnouncement(id) {
            const title = document.getElementById(`edit-title-${id}`).value.trim();
            const content = document.getElementById(`edit-content-${id}`).value.trim();
            const attachmentInput = document.getElementById(`edit-attachment-${id}`);
            const announcement = announcements.find(a => a.id === id);
            
            if (title && content && announcement) {
                if (attachmentInput.files.length > 0) {
                    const file = attachmentInput.files[0];
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        announcement.attachment = {
                            name: file.name,
                            type: file.type,
                            data: event.target.result.split(',')[1]
                        };
                        completeAnnouncementSave(id, title, content);
                    };
                    reader.readAsDataURL(file);
                } else {
                    completeAnnouncementSave(id, title, content);
                }
            }
        }

        function completeAnnouncementSave(id, title, content) {
            const announcement = announcements.find(a => a.id === id);
            announcement.title = title;
            announcement.content = content;
            announcement.editing = false;
            loadAnnouncements();
            saveData();
            showNotification('Announcement updated successfully!', 'success');
        }

        function removeAnnouncementAttachment(id) {
            const announcement = announcements.find(a => a.id === id);
            if (announcement) {
                announcement.attachment = null;
                loadAnnouncements();
            }
        }

        function cancelEditAnnouncement(id) {
            const announcement = announcements.find(a => a.id === id);
            if (announcement) {
                announcement.editing = false;
                loadAnnouncements();
            }
        }

        function deleteAnnouncement(id) {
            announcements = announcements.filter(a => a.id !== id);
            loadAnnouncements();
            saveData();
            showNotification('Announcement deleted', 'info');
        }

        // Suggestions functions with edit capability
        function loadSuggestions() {
            const container = document.getElementById('suggestionsList');
            container.innerHTML = '';

            suggestions.forEach(suggestion => {
                const card = document.createElement('div');
                card.className = 'card float-up';
                
                if (suggestion.editing) {
                    // Edit mode
                    card.innerHTML = `
                        <div class="form-group">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-input" id="edit-sug-title-${suggestion.id}" value="${suggestion.title}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-textarea" id="edit-sug-content-${suggestion.id}">${suggestion.content}</textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Type</label>
                            <select class="form-input" id="edit-sug-type-${suggestion.id}">
                                <option value="suggestion" ${suggestion.type === 'suggestion' ? 'selected' : ''}>Suggestion</option>
                                <option value="idea" ${suggestion.type === 'idea' ? 'selected' : ''}>Idea</option>
                                <option value="issue" ${suggestion.type === 'issue' ? 'selected' : ''}>Issue</option>
                            </select>
                        </div>
                        ${suggestion.attachment ? `
                        <div class="file-attachment">
                            <i class="fas fa-paperclip file-icon"></i>
                            <div class="file-name">${suggestion.attachment.name}</div>
                            <i class="fas fa-trash file-download" onclick="removeSuggestionAttachment(${suggestion.id})"></i>
                        </div>
                        ` : ''}
                        <div class="form-group">
                            <label class="form-label">Change Attachment (Optional)</label>
                            <input type="file" class="form-input" id="edit-sug-attachment-${suggestion.id}">
                        </div>
                        <div class="edit-controls">
                            <button class="btn-save" onclick="saveSuggestion(${suggestion.id})">Save</button>
                            <button class="btn-cancel" onclick="cancelEditSuggestion(${suggestion.id})">Cancel</button>
                        </div>
                    `;
                } else {
                    // Display mode
                    card.innerHTML = `
                        <div class="card-header">
                            <div class="card-title">${suggestion.title}</div>
                            <div class="card-date">${suggestion.date}</div>
                        </div>
                        <p>${suggestion.content}</p>
                        ${suggestion.attachment ? `
                        <div class="file-attachment">
                            <i class="fas fa-paperclip file-icon"></i>
                            <div class="file-name">${suggestion.attachment.name}</div>
                            <i class="fas fa-download file-download" onclick="downloadFile('${suggestion.attachment.name}', '${suggestion.attachment.data}')"></i>
                        </div>
                        ` : ''}
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <div>
                                <span class="status-badge status-${suggestion.type}">${suggestion.type.toUpperCase()}</span>
                                <small style="margin-left: 15px;">
                                    <div class="comment-author">
                                        <div class="comment-avatar" style="background-color: ${stringToColor(suggestion.authorCode)}">
                                            ${suggestion.author.charAt(0).toUpperCase()}
                                        </div>
                                        ${suggestion.author}
                                    </div>
                                </small>
                            </div>
                            <div class="vote-section">
                                <button class="vote-btn ${suggestion.userVote === 'up' ? 'voted' : ''}" onclick="vote(${suggestion.id}, 'up')">
                                    👍 ${suggestion.upvotes || 0}
                                </button>
                                <button class="vote-btn downvote ${suggestion.userVote === 'down' ? 'voted' : ''}" onclick="vote(${suggestion.id}, 'down')">
                                    👎 ${suggestion.downvotes || 0}
                                </button>
                            </div>
                        </div>
                        <div class="comment-section" id="comments-${suggestion.id}">
                            <h4>Comments</h4>
                            ${suggestion.comments && suggestion.comments.length > 0 ? 
                                suggestion.comments.map(comment => `
                                    <div class="comment">
                                        <div class="comment-author">
                                            <div class="comment-avatar" style="background-color: ${stringToColor(comment.authorCode)}">
                                                ${comment.author.charAt(0).toUpperCase()}
                                            </div>
                                            ${comment.author}
                                        </div>
                                        <div class="comment-date">${comment.date}</div>
                                        <p>${comment.content}</p>
                                    </div>
                                `).join('') : '<p>No comments yet</p>'}
                            <div class="form-group" style="margin-top: 15px;">
                                <textarea class="form-input" id="comment-${suggestion.id}" placeholder="Add a comment"></textarea>
                                <button class="btn-primary" style="margin-top: 10px;" onclick="addComment(${suggestion.id})">Post Comment</button>
                            </div>
                        </div>
                        ${suggestion.authorCode === currentUser.code ? `
                            <div class="edit-controls">
                                <button class="btn-edit" onclick="editSuggestion(${suggestion.id})">Edit</button>
                                <button class="btn-danger" onclick="deleteSuggestion(${suggestion.id})">Delete</button>
                            </div>
                        ` : ''}
                    `;
                }
                
                container.appendChild(card);
            });
        }

        function submitSuggestion() {
            const title = document.getElementById('suggestionTitle').value.trim();
            const content = document.getElementById('suggestionContent').value.trim();
            const type = document.getElementById('suggestionType').value;
            const attachmentInput = document.getElementById('suggestionAttachment');
            let attachment = null;

            if (title && content) {
                if (attachmentInput.files.length > 0) {
                    const file = attachmentInput.files[0];
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        attachment = {
                            name: file.name,
                            type: file.type,
                            data: event.target.result.split(',')[1]
                        };
                        completeSuggestionSubmit(title, content, type, attachment);
                    };
                    reader.readAsDataURL(file);
                } else {
                    completeSuggestionSubmit(title, content, type, null);
                }
            }
        }

        function completeSuggestionSubmit(title, content, type, attachment) {
            const newSuggestion = {
                id: Date.now(),
                title: title,
                content: content,
                type: type,
                date: new Date().toLocaleDateString(),
                author: currentUser.name,
                authorCode: currentUser.code,
                upvotes: 0,
                downvotes: 0,
                userVote: null,
                attachment: attachment,
                comments: []
            };

            suggestions.unshift(newSuggestion);
            loadSuggestions();
            
            document.getElementById('suggestionTitle').value = '';
            document.getElementById('suggestionContent').value = '';
            document.getElementById('suggestionType').value = 'suggestion';
            document.getElementById('suggestionAttachment').value = '';
            document.getElementById('suggestionFileName').textContent = 'No file chosen';
            document.getElementById('suggestionAttachmentPreview').innerHTML = '';
            
            saveData();
            showNotification('Suggestion submitted successfully!', 'success');
            playNotificationSound();
        }

        function editSuggestion(id) {
            const suggestion = suggestions.find(s => s.id === id);
            if (suggestion) {
                suggestion.editing = true;
                loadSuggestions();
            }
        }

        function saveSuggestion(id) {
            const title = document.getElementById(`edit-sug-title-${id}`).value.trim();
            const content = document.getElementById(`edit-sug-content-${id}`).value.trim();
            const type = document.getElementById(`edit-sug-type-${id}`).value;
            const attachmentInput = document.getElementById(`edit-sug-attachment-${id}`);
            const suggestion = suggestions.find(s => s.id === id);
            
            if (title && content && suggestion) {
                if (attachmentInput.files.length > 0) {
                    const file = attachmentInput.files[0];
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        suggestion.attachment = {
                            name: file.name,
                            type: file.type,
                            data: event.target.result.split(',')[1]
                        };
                        completeSuggestionSave(id, title, content, type);
                    };
                    reader.readAsDataURL(file);
                } else {
                    completeSuggestionSave(id, title, content, type);
                }
            }
        }

        function completeSuggestionSave(id, title, content, type) {
            const suggestion = suggestions.find(s => s.id === id);
            suggestion.title = title;
            suggestion.content = content;
            suggestion.type = type;
            suggestion.editing = false;
            loadSuggestions();
            saveData();
            showNotification('Suggestion updated successfully!', 'success');
        }

        function removeSuggestionAttachment(id) {
            const suggestion = suggestions.find(s => s.id === id);
            if (suggestion) {
                suggestion.attachment = null;
                loadSuggestions();
            }
        }

        function cancelEditSuggestion(id) {
            const suggestion = suggestions.find(s => s.id === id);
            if (suggestion) {
                suggestion.editing = false;
                loadSuggestions();
            }
        }

        function deleteSuggestion(id) {
            suggestions = suggestions.filter(s => s.id !== id);
            loadSuggestions();
            saveData();
            showNotification('Suggestion deleted', 'info');
        }

        function addComment(suggestionId) {
            const suggestion = suggestions.find(s => s.id === suggestionId);
            const commentInput = document.getElementById(`comment-${suggestionId}`);
            const content = commentInput.value.trim();
            
            if (content && suggestion) {
                if (!suggestion.comments) {
                    suggestion.comments = [];
                }
                
                suggestion.comments.push({
                    id: Date.now(),
                    content: content,
                    author: currentUser.name,
                    authorCode: currentUser.code,
                    date: new Date().toLocaleString()
                });
                
                commentInput.value = '';
                loadSuggestions();
                saveData();
            }
        }

        function vote(suggestionId, voteType) {
            const suggestion = suggestions.find(s => s.id === suggestionId);
            
            if (suggestion) {
                // Remove previous vote if exists
                if (suggestion.userVote === 'up') {
                    suggestion.upvotes--;
                } else if (suggestion.userVote === 'down') {
                    suggestion.downvotes--;
                }
                
                // Add new vote
                if (suggestion.userVote === voteType) {
                    // User is unvoting
                    suggestion.userVote = null;
                } else {
                    // User is voting or changing vote
                    suggestion.userVote = voteType;
                    if (voteType === 'up') {
                        suggestion.upvotes++;
                    } else {
                        suggestion.downvotes++;
                    }
                }
                
                loadSuggestions();
                saveData();
            }
        }

        // Stock Guide functions
        function loadStockGuide() {
            const stockGuideText = document.getElementById('stockGuideText');
            const stockGuideContent = document.getElementById('stockGuideContent');
            
            if (stockGuide) {
                stockGuideText.innerHTML = stockGuide;
            } else {
                // Default content
                stockGuideText.innerHTML = `
                    <h3>Product Sourcing Guide</h3>
                    <p>Welcome to the CTRLPLAY product sourcing guide. Here's how we acquire and manage our inventory:</p>
                    <h4>1. Supplier Research</h4>
                    <p>We research reliable suppliers who offer quality products at competitive prices.</p>
                    <h4>2. Quality Assessment</h4>
                    <p>All products undergo thorough quality checks before being added to our inventory.</p>
                    <h4>3. Inventory Management</h4>
                    <p>We use advanced inventory tracking systems to monitor stock levels and ensure availability.</p>
                    <h4>4. Customer Feedback Integration</h4>
                    <p>Customer reviews and feedback are continuously monitored to improve our product selection.</p>
                `;
            }
            
            if (stockGuideContent && currentUser.role === 'Admin') {
                stockGuideContent.value = stockGuide || stockGuideText.innerHTML;
            }
        }

        function updateStockGuide() {
            const content = document.getElementById('stockGuideContent').value.trim();
            
            if (content) {
                stockGuide = content;
                document.getElementById('stockGuideText').innerHTML = content;
                saveData();
                showNotification('Stock guide updated successfully!', 'success');
            }
        }

        // Files functions
        function loadFiles() {
            const container = document.getElementById('filesList');
            container.innerHTML = '';

            files.forEach(file => {
                const card = document.createElement('div');
                card.className = 'card float-up';
                
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${file.name}</div>
                        <div class="card-date">${file.uploadDate}</div>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 10px;">
                        <span class="status-badge">${file.type.toUpperCase()}</span>
                        <small style="margin-left: 15px;">
                            <div class="comment-author">
                                <div class="comment-avatar" style="background-color: ${stringToColor(file.uploaderCode)}">
                                    ${file.uploader.charAt(0).toUpperCase()}
                                </div>
                                ${file.uploader}
                            </div>
                        </small>
                    </div>
                    <div class="file-attachment" style="margin-top: 15px;">
                        <i class="fas ${getFileIcon(file.type)} file-icon"></i>
                        <div class="file-name">${file.name}</div>
                        <i class="fas fa-download file-download" onclick="downloadFile('${file.name}', '${file.fileData}')"></i>
                    </div>
                    ${currentUser.role === 'Admin' ? `
                        <div class="edit-controls">
                            <button class="btn-danger" onclick="deleteFile(${file.id})">Delete</button>
                        </div>
                    ` : ''}
                `;
                
                container.appendChild(card);
            });
        }

        function getFileIcon(type) {
            switch(type) {
                case 'document': return 'fa-file-alt';
                case 'image': return 'fa-file-image';
                case 'spreadsheet': return 'fa-file-excel';
                case 'presentation': return 'fa-file-powerpoint';
                default: return 'fa-file';
            }
        }

        function uploadFile() {
            const name = document.getElementById('fileName').value.trim();
            const type = document.getElementById('fileType').value;
            const fileInput = document.getElementById('fileUpload');
            
            if (name && fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    const newFile = {
                        id: Date.now(),
                        name: name,
                        type: type,
                        uploadDate: new Date().toLocaleDateString(),
                        uploader: currentUser.name,
                        uploaderCode: currentUser.code,
                        fileData: event.target.result.split(',')[1]
                    };
                    
                    files.unshift(newFile);
                    loadFiles();
                    
                    document.getElementById('fileName').value = '';
                    document.getElementById('fileType').value = 'document';
                    document.getElementById('fileUpload').value = '';
                    document.getElementById('uploadFileName').textContent = 'No file chosen';
                    
                    saveData();
                    showNotification('File uploaded successfully!', 'success');
                };
                reader.readAsDataURL(file);
            }
        }

        function deleteFile(id) {
            files = files.filter(f => f.id !== id);
            loadFiles();
            saveData();
            showNotification('File deleted', 'info');
        }

        function downloadFile(name, data) {
            const link = document.createElement('a');
            link.href = 'data:application/octet-stream;base64,' + data;
            link.download = name;
            link.click();
        }

        // Chat functions
        function loadChatUsers() {
            const container = document.getElementById('chatUsersList');
            container.innerHTML = '';
            
            for (const [code, user] of Object.entries(accessCodes)) {
                if (code !== currentUser.code) {
                    const userElement = document.createElement('div');
                    userElement.className = 'chat-user';
                    userElement.onclick = function() { selectChatUser(code); };
                    
                    userElement.innerHTML = `
                        <div class="chat-user-avatar" style="background-color: ${stringToColor(code)}">
                            ${user.customName ? user.customName.charAt(0).toUpperCase() : user.name.charAt(0).toUpperCase()}
                        </div>
                        <div>
                            <div>${user.customName || user.name}</div>
                            <small>${user.role}</small>
                        </div>
                    `;
                    
                    container.appendChild(userElement);
                }
            }
        }

        function selectChatUser(userCode) {
            currentChatUser = userCode;
            document.getElementById('chatHeader').innerHTML = `
                <div>
                    Chat with ${accessCodes[userCode].customName || accessCodes[userCode].name}
                </div>
                <button class="btn" onclick="toggleChatSidebar()">
                    <i class="fas fa-users"></i> Show Users
                </button>
            `;
            document.getElementById('chatInputArea').style.display = 'block';
            loadChatMessages(userCode);
        }

        function loadChatMessages(userCode) {
            const container = document.getElementById('chatMessages');
            container.innerHTML = '';
            
            // Initialize chat if it doesn't exist
            if (!chatMessages[userCode]) {
                chatMessages[userCode] = [];
            }
            
            // Display messages
            chatMessages[userCode].forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.className = `chat-message ${msg.sender === currentUser.code ? 'sent' : 'received'}`;
                
                messageElement.innerHTML = `
                    ${msg.sender !== currentUser.code ? `
                        <div class="message-sender">
                            <div class="message-sender-avatar" style="background-color: ${stringToColor(msg.sender)}">
                                ${accessCodes[msg.sender].customName ? accessCodes[msg.sender].customName.charAt(0).toUpperCase() : accessCodes[msg.sender].name.charAt(0).toUpperCase()}
                            </div>
                            ${accessCodes[msg.sender].customName || accessCodes[msg.sender].name}
                        </div>
                    ` : ''}
                    <div>${msg.content}</div>
                    ${msg.attachment ? `
                    <div class="file-attachment" style="margin-top: 10px;">
                        <i class="fas fa-paperclip file-icon"></i>
                        <div class="file-name">${msg.attachment.name}</div>
                        <i class="fas fa-download file-download" onclick="downloadFile('${msg.attachment.name}', '${msg.attachment.data}')"></i>
                    </div>
                    ` : ''}
                    <div class="message-time">${msg.time}</div>
                    ${msg.sender === currentUser.code ? `
                        <div class="message-actions">
                            <button class="message-action-btn" onclick="editChatMessage('${userCode}', ${msg.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="message-action-btn" onclick="deleteChatMessage('${userCode}', ${msg.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    ` : ''}
                `;
                
                container.appendChild(messageElement);
            });
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        function sendChatMessage() {
            const input = document.getElementById('chatMessageInput');
            const content = input.value.trim();
            const attachmentInput = document.getElementById('chatAttachment');
            let attachment = null;
            
            if ((content || attachmentInput.files.length > 0) && currentChatUser) {
                if (!chatMessages[currentChatUser]) {
                    chatMessages[currentChatUser] = [];
                }
                
                if (attachmentInput.files.length > 0) {
                    const file = attachmentInput.files[0];
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        attachment = {
                            name: file.name,
                            type: file.type,
                            data: event.target.result.split(',')[1]
                        };
                        completeChatMessage(content, attachment);
                    };
                    reader.readAsDataURL(file);
                } else {
                    completeChatMessage(content, null);
                }
            }
        }
        
        function completeChatMessage(content, attachment) {
            const newMessage = {
                id: Date.now(),
                sender: currentUser.code,
                receiver: currentChatUser,
                content: content,
                attachment: attachment,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            };
            
            chatMessages[currentChatUser].push(newMessage);
            document.getElementById('chatMessageInput').value = '';
            document.getElementById('chatAttachment').value = '';
            loadChatMessages(currentChatUser);
            saveData();
            playNotificationSound();
        }
        
        function editChatMessage(userCode, messageId) {
            const messages = chatMessages[userCode];
            const messageIndex = messages.findIndex(m => m.id === messageId);
            
            if (messageIndex !== -1) {
                const message = messages[messageIndex];
                const newContent = prompt("Edit your message:", message.content);
                
                if (newContent !== null) {
                    message.content = newContent;
                    message.edited = true;
                    loadChatMessages(userCode);
                    saveData();
                }
            }
        }
        
        function deleteChatMessage(userCode, messageId) {
            if (confirm("Are you sure you want to delete this message?")) {
                chatMessages[userCode] = chatMessages[userCode].filter(m => m.id !== messageId);
                loadChatMessages(userCode);
                saveData();
            }
        }

        // Profile functions
        function loadProfileData() {
            document.getElementById('displayName').value = currentUser.customName || currentUser.name;
            
            if (currentUser.avatar) {
                document.getElementById('avatarPreview').innerHTML = '';
                document.getElementById('avatarPreview').style.backgroundImage = `url(${currentUser.avatar})`;
                document.getElementById('avatarPreview').style.backgroundSize = 'cover';
            } else {
                document.getElementById('avatarPreview').style.backgroundImage = 'none';
                document.getElementById('avatarPreview').style.backgroundColor = stringToColor(currentUser.code);
                document.getElementById('avatarPreview').textContent = currentUser.name.charAt(0).toUpperCase();
            }
        }

        function updateProfile() {
            const displayName = document.getElementById('displayName').value.trim();
            const avatarInput = document.getElementById('avatarUpload');
            
            if (displayName) {
                currentUser.customName = displayName;
                currentUser.name = displayName;
                accessCodes[currentUser.code].customName = displayName;
                accessCodes[currentUser.code].name = displayName;
                
                document.getElementById('userName').textContent = displayName;
                
                if (avatarInput.files.length > 0) {
                    const file = avatarInput.files[0];
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        currentUser.avatar = event.target.result;
                        accessCodes[currentUser.code].avatar = event.target.result;
                        document.getElementById('avatarPreview').innerHTML = '';
                        document.getElementById('avatarPreview').style.backgroundImage = `url(${event.target.result})`;
                        document.getElementById('avatarPreview').style.backgroundSize = 'cover';
                        saveData();
                        showNotification('Profile updated successfully!', 'success');
                    };
                    reader.readAsDataURL(file);
                } else {
                    saveData();
                    showNotification('Profile updated successfully!', 'success');
                }
            }
        }

        // Admin functions
        function loadActiveUsers() {
            if (currentUser.role !== 'Admin') return;
            
            const container = document.getElementById('activeUsersList');
            container.innerHTML = '';
            
            Object.entries(activeUsers).forEach(([code, user]) => {
                const userElement = document.createElement('div');
                userElement.className = 'log-entry';
                userElement.innerHTML = `
                    <div>
                        <div class="comment-author">
                            <div class="comment-avatar" style="background-color: ${stringToColor(code)}">
                                ${user.name.charAt(0).toUpperCase()}
                            </div>
                            ${user.name} (${user.role})
                        </div>
                        <small>Last active: ${new Date(user.lastActive).toLocaleString()}</small>
                    </div>
                    <button class="force-logout-btn" onclick="forceLogout('${code}')">
                        <i class="fas fa-sign-out-alt"></i> Force Logout
                    </button>
                `;
                container.appendChild(userElement);
            });
        }
        
        function forceLogout(userCode) {
            if (confirm(`Are you sure you want to force ${activeUsers[userCode].name} to logout?`)) {
                delete activeUsers[userCode];
                saveData();
                loadActiveUsers();
                showNotification(`${activeUsers[userCode].name} has been logged out`, 'success');
            }
        }

        function loadAccessLogs() {
            if (currentUser.role !== 'Admin') return;
            
            const container = document.getElementById('accessLogs');
            container.innerHTML = '';

            accessLogs.slice(-20).reverse().forEach(log => {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `
                    <div>
                        <strong>${log.code}</strong> (${log.name})<br>
                        <small>${log.loginTime}</small>
                    </div>
                    <div>
                        <span class="status-badge status-${log.role.toLowerCase()}">${log.role}</span>
                        <i class="fas fa-info-circle" style="margin-left: 10px;"></i>
                    </div>
                    <div class="log-details">
                        <p><strong>User Agent:</strong> ${log.userAgent}</p>
                        <p><strong>Platform:</strong> ${log.platform}</p>
                        <p><strong>Language:</strong> ${log.language}</p>
                        <p><strong>IP Address:</strong> ${log.ip}</p>
                        <p><strong>Screen Resolution:</strong> ${window.screen.width}x${window.screen.height}</p>
                        <p><strong>Browser:</strong> ${getBrowserName()}</p>
                    </div>
                `;
                container.appendChild(logEntry);
            });
            
            // Add event listeners to show details
            document.querySelectorAll('.log-entry').forEach(entry => {
                entry.addEventListener('click', function() {
                    const details = this.querySelector('.log-details');
                    details.style.display = details.style.display === 'block' ? 'none' : 'block';
                });
            });
        }

        function getBrowserName() {
            const userAgent = navigator.userAgent;
            if (userAgent.indexOf("Firefox") > -1) return "Mozilla Firefox";
            if (userAgent.indexOf("SamsungBrowser") > -1) return "Samsung Browser";
            if (userAgent.indexOf("Opera") > -1 || userAgent.indexOf("OPR") > -1) return "Opera";
            if (userAgent.indexOf("Trident") > -1) return "Microsoft Internet Explorer";
            if (userAgent.indexOf("Edge") > -1) return "Microsoft Edge";
            if (userAgent.indexOf("Chrome") > -1) return "Google Chrome";
            if (userAgent.indexOf("Safari") > -1) return "Apple Safari";
            return "Unknown Browser";
        }

        function refreshAccessLogs() {
            loadAccessLogs();
            showNotification('Access logs refreshed', 'info');
        }

        function clearAccessLogs() {
            if (confirm('Are you sure you want to clear all access logs?')) {
                accessLogs = [];
                loadAccessLogs();
                showNotification('Access logs cleared', 'info');
            }
        }

        function loadCodesList() {
            if (currentUser.role !== 'Admin') return;
            
            const container = document.getElementById('codesList');
            container.innerHTML = '';

            for (const [code, data] of Object.entries(accessCodes)) {
                const codeItem = document.createElement('div');
                codeItem.className = 'log-entry';
                codeItem.innerHTML = `
                    <div>
                        <strong>${code}</strong><br>
                        <small>${data.customName || data.name} - ${data.role}</small>
                    </div>
                    <div>
                        <button class="delete-code-btn" onclick="deleteAccessCode('${code}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                container.appendChild(codeItem);
            }
        }

        function addAccessCode() {
            const newCode = document.getElementById('newAccessCode').value.trim().toUpperCase();
            const role = document.getElementById('newCodeRole').value;

            if (newCode && !accessCodes[newCode]) {
                const name = role === 'Admin' ? `Admin ${Object.values(accessCodes).filter(u => u.role === 'Admin').length + 1}` : 
                                              `Employee ${Object.values(accessCodes).filter(u => u.role === 'Employee').length + 1}`;
                
                accessCodes[newCode] = { role, name, avatar: '', customName: '' };
                
                document.getElementById('newAccessCode').value = '';
                document.getElementById('newCodeRole').value = 'Employee';
                
                saveData();
                loadCodesList();
                showNotification(`Access code ${newCode} added successfully!`, 'success');
            } else if (accessCodes[newCode]) {
                showNotification('Access code already exists!', 'error');
            } else {
                showNotification('Please enter a valid access code!', 'error');
            }
        }

        function deleteAccessCode(code) {
            if (confirm(`Are you sure you want to delete access code ${code}?`)) {
                if (currentUser.code === code) {
                    delete accessCodes[code];
                    logout();
                    return;
                }
                delete accessCodes[code];
                saveData();
                loadCodesList();
                showNotification(`Access code ${code} deleted`, 'info');
            }
        }

        // Helper function to generate color from string
        function stringToColor(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            let color = '#';
            for (let i = 0; i < 3; i++) {
                const value = (hash >> (i * 8)) & 0xFF;
                color += ('00' + value.toString(16)).substr(-2);
            }
            return color;
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center;">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}" 
                       style="margin-right: 10px; font-size: 1.2rem;"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            // Auto-remove after animation
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function playNotificationSound() {
            const sound = document.getElementById('notificationSound');
            sound.currentTime = 0;
            sound.play().catch(e => console.log("Audio play prevented:", e));
        }

        // Welcome message after login
        function showWelcomeMessage() {
            setTimeout(() => {
                showNotification(`Welcome to CTRLPLAY Portal, ${currentUser.name}!`, 'success');
                playNotificationSound();
            }, 500);
        }

        // Data persistence functions
        function saveData() {
            const data = {
                announcements,
                suggestions,
                files,
                accessLogs,
                stockGuide,
                accessCodes,
                chatMessages,
                activeUsers
            };
            localStorage.setItem('ctrlplayData', JSON.stringify(data));
        }

        function loadData() {
            const savedData = localStorage.getItem('ctrlplayData');
            if (savedData) {
                const data = JSON.parse(savedData);
                announcements = data.announcements || [];
                suggestions = data.suggestions || [];
                files = data.files || [];
                accessLogs = data.accessLogs || [];
                stockGuide = data.stockGuide || '';
                accessCodes = data.accessCodes || accessCodes;
                chatMessages = data.chatMessages || {};
                activeUsers = data.activeUsers || {};
            }
        }

        // Responsive design handlers
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        });

        // Auto-refresh announcements every 30 seconds
        setInterval(function() {
            if (currentUser.role && document.getElementById('announcements').classList.contains('active')) {
                loadAnnouncements();
            }
        }, 30000);
    </script>
<script src="/static/js/ctrlplay.js" type="module"></script></body>
</html>
